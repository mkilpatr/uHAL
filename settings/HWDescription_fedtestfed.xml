<?xml version='1.0' encoding='utf-8'?>
<HwDescription>
    <AMC13>
        <connection id="T1" uri="chtcp-2.0://cmsuppixch:10203?target=fedamc13T1:50001" address_table="file://settings/AMC13XG_T1.xml" />
        <connection id="T2" uri="chtcp-2.0://cmsuppixch:10203?target=fedamc13T2:50001" address_table="file://settings/AMC13XG_T2.xml" />
        <AMCmask enable="1,2,3,4,5,6,7,8,12" />
        <!--This is used to send a calibration Trigger via the AMC13s internal BGO mechanism, 0x2c is the command configured as BGO15 
             on the TTCci - repeat is obvious, prescale is in orbits, the bx is selected such that it occurs 98 BX before the local
             L1A which is periodic at BX500 every orbit-->
        <!-- for the DEV lab setup in B186, the bx has to be 381 for the BU clock source and 380 for the TTCci as clock source -->
        <!--<BGO command="0x2c" repeat="1" prescale="0" bx="381" />  <!-- CAL-SYNC-Reset -->
        <BGO command="0x14" repeat="0" prescale="330000" bx="481" />
	<!--<BGO command="0x2e" repeat="0" prescale="0" bx="0" />-->
        <!-- Local enables Local L1A, mode 0 means a trigger every orbit at BX500, rate is 1 for every orbit and burst is 1 
             for 1 trigger when sending burst (equivalent to single trigger -->
        <Trigger local="1" mode="2" rate="60000" burst="1" rules="0" />
        <!--<Register tounge="T1" name="test.test">0</Register>-->
        <TTCSimulator>1</TTCSimulator>
    </AMC13>
    <PixFED Id="0" boardType="CTA">
        <connection id="board0" uri="chtcp-2.0://cmsuppixch:10203?target=fedtestfed4:50001" address_table="file://settings/address_table.xml" />
        <!--connection id="board0" uri="chtcp-2.0://cmsuppixch:10203?target=pilotfed:50001" address_table="file://settings/address_table.xml" />-->

        <!-- ACQUISITION MODE & CALIBRATION MODE & DATA TYPE -->
        <!--1: TBM fifo, 2: Slink FIFO, 4: FEROL-->
        <Register name="pixfed_ctrl_regs.acq_ctrl.acq_mode">4</Register>
        <Register name="pixfed_ctrl_regs.acq_ctrl.calib_mode">0</Register>
        <!--this is 0-indexed so 9 will correspond to 10 events-->
        <Register name="pixfed_ctrl_regs.acq_ctrl.calib_mode_NEvents">6</Register>
        <!--0: real data, 1: constants after TBM fifo, 2: pattern before TBM fifo-->
        <Register name="pixfed_ctrl_regs.data_type">0x0</Register>
        <!-- 0 indexed -->
        <Register name="fe_ctrl_regs.fifo_1_to_read"> 0 </Register>
        <Register name="fe_ctrl_regs.fifo_config.channel_of_interest">0</Register>
        <!--o for PSI46dig-->
        <Register name="fe_ctrl_regs.fifo_config.TBM_old_new">0x0</Register>
        <Register name="fe_ctrl_regs.fifo_config.overflow_value_a">0x399</Register>
        <Register name="fe_ctrl_regs.fifo_config.overflow_value_b">0x399</Register>

        <!--SLINK HEADER & TRAILER-->
        <Register name="pixfed_ctrl_regs.slink_ctrl.privateEvtNb">0x01</Register>
        <Register name="pixfed_ctrl_regs.slink_ctrl.slinkFormatH_source_id">0x01</Register>
        <Register name="pixfed_ctrl_regs.slink_ctrl.slinkFormatH_FOV">0xe</Register>
        <Register name="pixfed_ctrl_regs.slink_ctrl.slinkFormatH_Evt_ty">0xa</Register>
        <Register name="pixfed_ctrl_regs.slink_ctrl.slinkFormatH_Evt_stat">0xf</Register>

        <!-- TBM MASK -->
        <Register name="pixfed_ctrl_regs.TBM_MASK_1">0xFF00FFFF</Register>
        <Register name="pixfed_ctrl_regs.TBM_MASK_2">0x00000000</Register>
        <Register name="pixfed_ctrl_regs.tbm_trailer_status_mask">0x00</Register>
        <!--<Register name="pixfed_ctrl_regs.PACKET_NB">10</Register>-->

        <!--TTS CONFIG-->
	<Register name="pixfed_ctrl_regs.force_reset_all_tbm_fifo_from_BSY"> 0 </Register>
	<Register name="pixfed_ctrl_regs.trailer_timeout_valid"> 1 </Register>
        <Register name="pixfed_ctrl_regs.trailerTimeoutValue"> 31 </Register>
	<Register name="pixfed_ctrl_regs.TBM_H_ID_check_valid"> 1 </Register>
        <Register name="pixfed_ctrl_regs.tts.timeout_check_valid"> 1 </Register>
        <Register name="pixfed_ctrl_regs.tts.event_cnt_check_valid"> 1 </Register>
        <Register name="pixfed_ctrl_regs.tts.timeout_value"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_00"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_01"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_02"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_03"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_04"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_05"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_06"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_07"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_08"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_09"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_10"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_11"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_12"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_13"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_14"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_15"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_16"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_17"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_18"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_19"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_20"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_21"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_22"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_23"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_24"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_25"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_26"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_27"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_28"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_29"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_30"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_31"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_32"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_33"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_34"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_35"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_36"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_37"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_38"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_39"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_40"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_41"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_42"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_43"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_44"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_45"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_46"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.evt_timeout_value.tbm_ch_47"> 255 </Register>
	<Register name="pixfed_ctrl_regs.tts.evt_err_nb_oos_thresh"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.timeout_nb_oos_thresh"> 255 </Register>
        <Register name="pixfed_ctrl_regs.tts.bc0_ec0_polar"> 0 </Register>
        <Register name="pixfed_ctrl_regs.tts.force_RDY"> 0 </Register>
	<!-- The TTS state of the FED can be forced in any state (enable = 1): TTS_RDY  = 0x8, TTS_BUSY = 0x4, TTS_OOS  = 0x2, TTS_WARN = 0x1 -->
	<Register name="pixfed_ctrl_regs.force_TTS.enable"> 0x0 </Register>
	<Register name="pixfed_ctrl_regs.force_TTS.state"> 0x8 </Register>
	<!-- Offset applied on the BX counter (BX_id on SLINK data format) 12bit -->
	
	<Register name="pixfed_ctrl_regs.trailer_timeout_valid"> 1 </Register>
	<Register name="pixfed_ctrl_regs.trailerTimeoutValue"> 255 </Register>
	<Register name="pixfed_ctrl_regs.BX_cnt_offset"> 0x000 </Register>
        <!--Mask operation for the TBM trailer (STATUS1) STATUS1(7:0) = [NoTokenPass - ResetTBM - ResetROC - SyncError - SyncTrigger - ClrTrigCnt - CalTrig - Stackful] Masked or not with trailer_status_mask1[7:0]-->
        <Register name="pixfed_ctrl_regs.tbm_trailer_status_mask"> 0xff </Register>
        <!--Mask operation for the TBM trailer STATUS2 or ERR_BITS STATUS2(2:0) = [WrongNbOfROCs - AutoResetSent - PKAMReseSent] Masked or not with trailer_status_mask2(2:0)-->
        <Register name="pixfed_ctrl_regs.tbm_trailer_status_mask2"> 0x7 </Register>

	<!--TTC History mask-->
	<!--Active high, set to 1 to mask BC0 -->
	<Register name="pixfed_ctrl_regs.ttc.history_ttc_bc0_mask"> 0 </Register>
	<!--Active high, set to 1 to mask EC0 -->
	<Register name="pixfed_ctrl_regs.ttc.history_ttc_ec0_mask"> 0 </Register>
	<!--Active high, set to 1 to mask RESET -->
	<Register name="pixfed_ctrl_regs.ttc.history_ttc_reset_mask"> 0 </Register>

        <!--CLOCK-->
        <!--Used to set the CLK input to the TTC clock from the BP - 3 is XTAL, 0 is BP-->
        <Register name="ctrl.ttc_xpoint_A_out3">0</Register>
        <!--<Register name="ctrl.mgt_xpoint_out1">3 </Register>-->
        <!--2 to have 156 MHz clock (obligatory for 10G sling), 3 for 125Mhz clock for 5g on SLink -->
        <Register name="ctrl.mgt_xpoint_out1">3 </Register>

        <!-- FITELS -->
        <Fitel_Files path="./settings/" />
        <Fitel FMC="0" Id="0" file="FMCFITEL.txt" Enable="" />
        <Fitel FMC="0" Id="1" file="FMCFITEL.txt" Enable="1" />
    </PixFED>
    <PixFED Id="1" boardType="GLIB">
	<connection id="board1" uri="chtcp-2.0://cmsuppixpc001:10203?target=GLIB1:50001" address_table="file://settings/addr_table_multi_chan.xml" />
    </PixFED>
    <PixFED Id="2" boardType="GLIB">
	<connection id="board2" uri="chtcp-2.0://cmsuppixpc001:10203?target=GLIB2:50001" address_table="file://settings/addr_table_multi_chan.xml" />
    </PixFED>
    <PixFED Id="3" boardType="GLIB">
	<connection id="board3" uri="chtcp-2.0://cmsuppixpc001:10203?target=GLIB3:50001" address_table="file://settings/addr_table_multi_chan.xml" />
    </PixFED>
</HwDescription>

<Settings>
    <!-- 0 indexed -->
    <Setting name="ROCOfInterest">1</Setting>
    <Setting name="BlockSize">512</Setting>
    <!--if set to 0, loop will run forever-->
    <Setting name="NAcq">0</Setting>
</Settings>
